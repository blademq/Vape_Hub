<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CloudHub | Магазин вейп-продукции</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

:root {
  --primary: #8a2be2;
  --primary-dark: #6a1cb0;
  --secondary: #ff6b9d;
  --dark: #0c0c14;
  --dark-light: #1a1a24;
  --darker: #07070c;
  --light: #f0f0f5;
  --gray: #a0a0b0;
  --success: #2be28a;
  --danger: #ff4757;
  --warning: #ffa502;
}

body {
  background-color: var(--dark);
  color: var(--light);
  min-height: 100vh;
  padding-bottom: 80px;
}

/* Header */
header {
  background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-icon {
  color: var(--primary);
  font-size: 24px;
}

.logo-text {
  font-weight: 700;
  font-size: 22px;
  background: linear-gradient(to right, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.currency {
  font-size: 12px;
  color: var(--gray);
  margin-left: 5px;
}

.header-actions {
  display: flex;
  gap: 15px;
}

.icon-btn {
  background: var(--dark-light);
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

.icon-btn:hover {
  background: var(--primary);
  transform: translateY(-2px);
}

/* Поиск */
.search-container {
  margin: 20px;
}

.search-box {
  background: var(--dark-light);
  border-radius: 50px;
  padding: 14px 20px;
  display: flex;
  align-items: center;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(138, 43, 226, 0.2);
}

.search-box i {
  color: var(--gray);
  margin-right: 10px;
}

.search-box input {
  flex: 1;
  background: none;
  border: none;
  color: var(--light);
  font-size: 16px;
  outline: none;
}

/* Категории */
.categories {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  padding: 0 20px 20px;
  margin-bottom: 20px;
}

.category-card {
  background: var(--dark-light);
  border-radius: 15px;
  padding: 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: all 0.3s;
  text-align: center;
}

.category-card:hover {
  background: rgba(138, 43, 226, 0.1);
  transform: translateY(-3px);
}

.category-image {
  width: 60px;
  height: 60px;
  object-fit: contain;
  margin-bottom: 10px;
  border-radius: 10px;
}

.category-name {
  font-size: 14px;
  font-weight: 600;
}

/* Товары */
.products-grid {
  padding: 0 20px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-bottom: 30px;
}

.product-card {
  background: var(--dark-light);
  border-radius: 15px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(138, 43, 226, 0.2);
}

.product-image {
  height: 140px;
  background: #1a1a24;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 15px;
}

.product-image img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.product-info {
  padding: 15px;
}

.product-name {
  font-weight: 600;
  margin-bottom: 5px;
  font-size: 16px;
}

.product-category {
  font-size: 12px;
  color: var(--gray);
  margin-bottom: 10px;
}

.product-price {
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 15px;
  font-size: 18px;
}

.btn-select {
  background: linear-gradient(to right, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  padding: 10px;
  border-radius: 10px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
  width: 100%;
}

.btn-select:hover {
  background: linear-gradient(to right, var(--primary-dark), var(--primary));
  box-shadow: 0 5px 15px rgba(138, 43, 226, 0.3);
}

/* Модальное окно выбора вкуса */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(10, 10, 15, 0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-container {
  background: var(--dark-light);
  border-radius: 20px;
  width: 100%;
  max-width: 500px;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
  transform: translateY(20px);
  transition: all 0.3s;
}

.modal-overlay.active .modal-container {
  transform: translateY(0);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-title {
  font-size: 22px;
  font-weight: 700;
  background: linear-gradient(to right, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.modal-close {
  background: var(--dark);
  color: var(--gray);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.modal-close:hover {
  background: var(--danger);
  color: white;
}

.modal-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.flavor-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.flavor-item {
  background: var(--dark);
  border-radius: 12px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s;
  border: 2px solid transparent;
  position: relative;
}

.flavor-item:hover {
  background: rgba(138, 43, 226, 0.1);
  border-color: rgba(138, 43, 226, 0.3);
}

.flavor-item.selected {
  background: rgba(138, 43, 226, 0.15);
  border-color: var(--primary);
}

.flavor-name {
  font-weight: 600;
  font-size: 16px;
}

.flavor-check {
  position: absolute;
  top: 15px;
  right: 15px;
  color: var(--primary);
  font-size: 18px;
  opacity: 0;
}

.flavor-item.selected .flavor-check {
  opacity: 1;
}

.modal-footer {
  padding: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  gap: 10px;
}

.modal-footer .btn-primary {
  flex: 1;
}

.btn-primary {
  background: linear-gradient(to right, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  padding: 14px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(138, 43, 226, 0.3);
}

.btn-secondary {
  background: transparent;
  color: var(--gray);
  border: 1px solid var(--gray);
  padding: 14px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-secondary:hover {
  color: var(--light);
  border-color: var(--light);
}

/* Нижняя навигация */
.nav-footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--darker);
  display: flex;
  justify-content: space-around;
  padding: 15px 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 100;
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: all 0.3s;
  padding: 5px 15px;
  border-radius: 12px;
  position: relative;
}

.nav-item i {
  font-size: 20px;
  margin-bottom: 4px;
}

.nav-item span {
  font-size: 12px;
}

.nav-item.active {
  color: var(--primary);
  background: rgba(138, 43, 226, 0.1);
}

.cart-badge {
  position: absolute;
  top: -5px;
  right: 5px;
  background: var(--secondary);
  color: white;
  font-size: 10px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
}

/* Страница корзины */
.cart-page {
  display: none;
}

.back-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 20px;
  cursor: pointer;
  color: var(--primary);
  font-weight: 600;
}

.back-btn i {
  font-size: 18px;
}

.cart-items {
  padding: 0 20px;
}

.cart-item {
  background: var(--dark-light);
  border-radius: 15px;
  padding: 15px;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.cart-item-info {
  flex: 1;
}

.cart-item-name {
  font-weight: 600;
  margin-bottom: 5px;
}

.cart-item-flavor {
  font-size: 12px;
  color: var(--gray);
  margin-bottom: 5px;
}

.cart-item-price {
  font-weight: 700;
  color: var(--primary);
}

.btn-remove {
  background: var(--danger);
  color: white;
  border: none;
  width: 36px;
  height: 36px;
  border-radius: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.btn-remove:hover {
  background: #ff2e43;
  transform: scale(1.1);
}

.cart-summary {
  background: var(--dark-light);
  border-radius: 20px;
  padding: 20px;
  margin: 20px;
  margin-top: 30px;
}

.cart-total {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.cart-total-amount {
  color: var(--primary);
}

.telegram-payment {
  background: #2aabee;
  color: white;
  border: none;
  padding: 16px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  margin-top: 10px;
}

.telegram-payment:hover {
  background: #229ed9;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(42, 171, 238, 0.3);
}

.payment-info {
  margin-top: 20px;
  padding: 15px;
  background: rgba(42, 171, 238, 0.1);
  border-radius: 12px;
  text-align: center;
}

.payment-info p {
  margin-bottom: 10px;
  color: var(--gray);
}

.telegram-username {
  background: var(--dark);
  padding: 10px 15px;
  border-radius: 10px;
  font-family: monospace;
  color: var(--primary);
  font-weight: 600;
  display: inline-block;
  margin: 10px 0;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
}

.empty-state i {
  font-size: 60px;
  color: var(--gray);
  margin-bottom: 20px;
  opacity: 0.5;
}

.empty-state h3 {
  margin-bottom: 10px;
  color: var(--light);
}

.empty-state p {
  color: var(--gray);
  margin-bottom: 20px;
}

/* Адаптивность */
@media (min-width: 768px) {
  .products-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .modal-container {
    max-width: 600px;
  }
  
  .flavor-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
  }
}
</style>
</head>
<body>

<header>
  <div class="logo" onclick="goToHome()">
    <div class="logo-icon">
      <i class="fas fa-cloud"></i>
    </div>
    <div class="logo-text">CloudHub<span class="currency">(zł)</span></div>
  </div>
  
  <div class="header-actions">
    <div class="icon-btn" onclick="openCartPage()">
      <i class="fas fa-shopping-cart"></i>
      <div class="cart-badge" id="header-cart-badge">0</div>
    </div>
  </div>
</header>

<main>
  <!-- Главная страница магазина -->
  <div id="shop-page" style="display: block;">
    <div class="search-container">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Поиск жидкостей..." oninput="searchProducts()">
      </div>
    </div>
    
    <div class="categories">
      <div class="category-card" onclick="filterProducts('Жидкости')">
        <img src="https://i.imgur.com/QGv2Uvv.png" alt="Жидкости" class="category-image">
        <div class="category-name">Жидкости</div>
      </div>
      
      <div class="category-card" onclick="filterProducts('Одноразки')">
        <img src="https://i.imgur.com/xhr3S0G.png" alt="Одноразки" class="category-image">
        <div class="category-name">Одноразки</div>
      </div>
      
      <div class="category-card" onclick="filterProducts('Поды')">
        <img src="https://i.imgur.com/PW1Pqyz.png" alt="Поды" class="category-image">
        <div class="category-name">Поды</div>
      </div>
      
      <div class="category-card" onclick="filterProducts('Картриджи')">
        <img src="https://i.imgur.com/gvDaEyg.png" alt="Картриджи" class="category-image">
        <div class="category-name">Картриджи</div>
      </div>
    </div>
    
    <div class="products-grid" id="products-container">
      <!-- Товары будут загружены через JavaScript -->
    </div>
  </div>
  
  <!-- Страница корзины -->
  <div id="cart-page" class="cart-page">
    <div class="back-btn" onclick="goToHome()">
      <i class="fas fa-arrow-left"></i>
      <span>Назад в каталог</span>
    </div>
    
    <div class="cart-items" id="cart-items-container">
      <!-- Товары в корзине -->
    </div>
    
    <div id="cart-summary-container">
      <!-- Сумма заказа -->
    </div>
  </div>
</main>

<!-- Нижняя навигация -->
<div class="nav-footer">
  <div class="nav-item active" onclick="goToHome()">
    <i class="fas fa-store"></i>
    <span>Каталог</span>
  </div>
  
  <div class="nav-item" onclick="openCartPage()">
    <i class="fas fa-shopping-cart"></i>
    <span>Корзина</span>
    <div class="cart-badge" id="cart-badge">0</div>
  </div>
</div>

<!-- Модальное окно выбора вкуса -->
<div id="flavor-modal" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-title" id="modal-title">Выберите вкус</div>
      <button class="modal-close" onclick="closeFlavorModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-content">
      <div class="flavor-list" id="flavor-list">
        <!-- Список вкусов будет добавлен через JS -->
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-primary" onclick="addToCartWithFlavor()">
        <i class="fas fa-cart-plus"></i>
        Добавить в корзину
      </button>
      <button class="btn-secondary" onclick="closeFlavorModal()">
        Отмена
      </button>
    </div>
  </div>
</div>

<script>
// ========== ДАННЫЕ ТОВАРОВ ==========

// Все товары с картинками
const allProducts = [
  // ========== ЖИДКОСТИ ==========
  // Elfliq
  {
    id: 1,
    name: 'Elfliq 30ml 5%',
    category: 'Жидкости',
    price: 45,
    image: 'https://i.imgur.com/vEq09Ta.png',
    description: 'Elfliq — фірмові рідини Elf Bar з яскравими та впізнаваними смаками',
    flavors: [
      'Apple Pear',
      'Blackberry Lemon',
      'Blackcurrant aniseed',
      'Blueberry',
      'Blueberry Raspberry Pomegranate',
      'Blueberry Rose Mint',
      'Blueberry Sour Raspberry',
      'Blue Razz Ice',
      'Blue Razz Lemonade',
      'Cherry',
      'Cherry Cola',
      'Cherry Lemon Peach',
      'Cola',
      'Cool Mint',
      'Double Apple'
    ]
  },
  
  // Chaser Lux 30ml 5%
  {
    id: 2,
    name: 'Chaser Lux 30ml 5%',
    category: 'Жидкости',
    price: 50,
    image: 'https://i.imgur.com/IeTuHXS.png',
    description: 'Премиальная линейка солей для POD-систем',
    flavors: [
      'Tropic Punch Orange',
      'Coconut Melon',
      'Vitamine',
      'Kiwi Passionfruit Guava',
      'Blueberry Raspberry',
      'Sangria',
      'Turbo mint'
    ]
  },
  
  // Chaser Lux 30ml 6%
  {
    id: 3,
    name: 'Chaser Lux 30ml 6%',
    category: 'Жидкости',
    price: 50,
    image: 'https://i.imgur.com/Z0dIMUY.png',
    description: 'Премиальная линейка солей для POD-систем',
    flavors: [
      'Sour Apple',
      'Blackberry Lemonade',
      'Sour Watermelon Candy',
      'Peach Yogurt',
      'Blueberry Raspberry',
      'Grape Mint',
      'Watermelon Raspberry',
      'Peach Tea',
      'Kiwi Passion Fruit Guava',
      'Cider Berry',
      'Coconut Melon'
    ]
  },
  
  // Chaser for pods 30ml 5%
  {
    id: 4,
    name: 'Chaser for pods 30ml 5%',
    category: 'Жидкости',
    price: 50,
    image: 'https://i.imgur.com/n8NuNv9.png',
    description: 'Специально разработан для POD-систем',
    flavors: [
      'Ягоди',
      'Блакитна малина',
      'М\'ята',
      'Персик',
      'Полуниця',
      'Кавун',
      'Диня',
      'Грейпфрут',
      'Жовта малина'
    ]
  },
  
  // CHASER LIMITINI EDITINI 30ML 5%
  {
    id: 5,
    name: 'CHASER LIMITINI EDITINI 30ML 5%',
    category: 'Жидкости',
    price: 50,
    image: 'https://i.imgur.com/4LDRirY.png',
    description: 'Лимитированная серия с уникальными вкусами',
    flavors: [
      'ALOE MINT',
      'JASMINE PEACH',
      'PINEAPPLE PASSION LIME',
      'BALERRINA CAPPUCCINO',
      'GLORBO FRUTTODRILLO',
      'TUNG TUNG TUNG SAHUR'
    ]
  },
  
  // ========== ОДНОРАЗКИ ==========
  {
    id: 6,
    name: 'ELFBAR RAYA D3 - 25.000 PUFFS',
    category: 'Одноразки',
    price: 80,
    image: 'https://i.imgur.com/xhr3S0G.png',
    description: 'Одноразовая электронная сигарета на 25,000 затяжек',
    flavors: [
      'Blueberry Ice',
      'Strawberry Grape',
      'Blackberry Cranberry',
      'Watermelon Ice',
      'Strawberry Watermelon',
      'Peach Ice',
      'Strawberry Ice',
      'Blue Razz Ice',
      'Blueberry Raspberry',
      'Grape Mint',
      'Watermelon Bubble Gum',
      'Apple Peach',
      'Strawberry Banana',
      'Strawberry Peach',
      'Lemon Watermelon',
      'VMT'
    ]
  },
  
  // ========== ПОДЫ ==========
  {
    id: 7,
    name: 'VAPRESSO XROS 5 MINI',
    category: 'Поды',
    price: 120,
    image: 'https://i.imgur.com/PW1Pqyz.png',
    description: 'Компактная POD-система',
    flavors: [
      'CARBON BLACK',
      'SKY BLUE',
      'PURPLE',
      'PASTEL CRYSTAL',
      'TITANIUM SILVER',
      'FLOWING GREEN'
    ]
  },
  
  // ========== КАРТРИДЖИ ==========
  {
    id: 8,
    name: 'Катридж XROS 5 MINI',
    category: 'Картриджи',
    price: 25,
    image: 'https://i.imgur.com/gvDaEyg.png',
    description: 'Сменные картриджи',
    flavors: [
      '3ml 0.4Ω',
      '2ml 0.6Ω'
    ]
  }
];

// Корзина
let cart = [];
let currentProduct = null;
let selectedFlavor = null;

// ========== ОСНОВНЫЕ ФУНКЦИИ ==========

// Загрузка страницы
document.addEventListener('DOMContentLoaded', function() {
  // Загружаем корзину из localStorage
  const savedCart = localStorage.getItem('vapeCart');
  if (savedCart) {
    cart = JSON.parse(savedCart);
    updateCartBadge();
  }
  
  // Отображаем товары
  renderProducts(allProducts);
});

// Отображение товаров
function renderProducts(products) {
  const container = document.getElementById('products-container');
  container.innerHTML = '';
  
  if (products.length === 0) {
    container.innerHTML = `
      <div class="empty-state" style="grid-column: 1 / -1;">
        <i class="fas fa-box-open"></i>
        <h3>Товары не найдены</h3>
        <p>Попробуйте изменить запрос поиска</p>
      </div>
    `;
    return;
  }
  
  products.forEach(product => {
    const productCard = document.createElement('div');
    productCard.className = 'product-card';
    
    // Определяем текст кнопки в зависимости от наличия вкусов
    const buttonText = product.flavors && product.flavors.length > 0 ? 'Выбрать вкус' : 'В корзину';
    const buttonAction = product.flavors && product.flavors.length > 0 ? 
      `openFlavorModal(${product.id})` : 
      `addToCartSimple(${product.id})`;
    
    productCard.innerHTML = `
      <div class="product-image">
        <img src="${product.image}" alt="${product.name}">
      </div>
      <div class="product-info">
        <div class="product-name">${product.name}</div>
        <div class="product-category">${product.category}</div>
        <div class="product-price">${product.price.toFixed(2)} zł</div>
        <button class="btn-select" onclick="${buttonAction}">${buttonText}</button>
      </div>
    `;
    
    container.appendChild(productCard);
  });
}

// Поиск товаров
function searchProducts() {
  const searchInput = document.getElementById('searchInput');
  const query = searchInput.value.toLowerCase();
  
  if (!query) {
    renderProducts(allProducts);
    return;
  }
  
  const filtered = allProducts.filter(product => 
    product.name.toLowerCase().includes(query) ||
    product.category.toLowerCase().includes(query) ||
    product.description.toLowerCase().includes(query)
  );
  
  renderProducts(filtered);
}

// Фильтрация по категориям
function filterProducts(category) {
  if (!category) {
    renderProducts(allProducts);
    return;
  }
  
  const filtered = allProducts.filter(product => product.category === category);
  renderProducts(filtered);
}

// Обновление бейджа корзины
function updateCartBadge() {
  const count = cart.length;
  document.getElementById('cart-badge').textContent = count;
  document.getElementById('header-cart-badge').textContent = count;
}

// ========== МОДАЛЬНОЕ ОКНО ВКУСОВ ==========

// Открыть модальное окно выбора вкуса
function openFlavorModal(productId) {
  currentProduct = allProducts.find(p => p.id === productId);
  selectedFlavor = null;
  
  if (!currentProduct) return;
  
  // Устанавливаем заголовок
  document.getElementById('modal-title').textContent = `Выберите вкус (${currentProduct.name})`;
  
  // Заполняем список вкусов
  const flavorList = document.getElementById('flavor-list');
  flavorList.innerHTML = '';
  
  currentProduct.flavors.forEach(flavor => {
    const flavorItem = document.createElement('div');
    flavorItem.className = 'flavor-item';
    flavorItem.onclick = () => selectFlavor(flavor);
    
    flavorItem.innerHTML = `
      <div class="flavor-name">${flavor}</div>
      <div class="flavor-check">
        <i class="fas fa-check"></i>
      </div>
    `;
    
    flavorList.appendChild(flavorItem);
  });
  
  // Показываем модальное окно
  document.getElementById('flavor-modal').classList.add('active');
}

// Закрыть модальное окно
function closeFlavorModal() {
  document.getElementById('flavor-modal').classList.remove('active');
  currentProduct = null;
  selectedFlavor = null;
}

// Выбрать вкус
function selectFlavor(flavor) {
  selectedFlavor = flavor;
  
  // Снимаем выделение со всех
  document.querySelectorAll('.flavor-item').forEach(item => {
    item.classList.remove('selected');
  });
  
  // Выделяем выбранный
  const flavorItems = document.querySelectorAll('.flavor-item');
  flavorItems.forEach(item => {
    if (item.querySelector('.flavor-name').textContent === flavor) {
      item.classList.add('selected');
    }
  });
}

// Добавить в корзину с выбранным вкусом
function addToCartWithFlavor() {
  if (!currentProduct) return;
  
  if (!selectedFlavor && currentProduct.flavors.length > 0) {
    alert('Пожалуйста, выберите вкус');
    return;
  }
  
  const cartItem = {
    id: Date.now(), // Уникальный ID
    productId: currentProduct.id,
    name: currentProduct.name,
    flavor: selectedFlavor,
    category: currentProduct.category,
    price: currentProduct.price,
    image: currentProduct.image
  };
  
  cart.push(cartItem);
  saveCart();
  updateCartBadge();
  closeFlavorModal();
  
  // Показываем уведомление
  showNotification(`Товар добавлен в корзину: ${currentProduct.name}${selectedFlavor ? ` (${selectedFlavor})` : ''}`);
}

// Добавить в корзину без выбора вкуса (для товаров без вкусов)
function addToCartSimple(productId) {
  const product = allProducts.find(p => p.id === productId);
  if (!product) return;
  
  const cartItem = {
    id: Date.now(),
    productId: product.id,
    name: product.name,
    flavor: null,
    category: product.category,
    price: product.price,
    image: product.image
  };
  
  cart.push(cartItem);
  saveCart();
  updateCartBadge();
  
  showNotification(`Товар добавлен в корзину: ${product.name}`);
}

// Сохранить корзину
function saveCart() {
  localStorage.setItem('vapeCart', JSON.stringify(cart));
}

// ========== КОРЗИНА ==========

// Открыть страницу корзины
function openCartPage() {
  document.getElementById('shop-page').style.display = 'none';
  document.getElementById('cart-page').style.display = 'block';
  
  // Обновляем навигацию
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
  });
  document.querySelectorAll('.nav-item')[1].classList.add('active');
  
  renderCart();
}

// Вернуться на главную
function goToHome() {
  document.getElementById('shop-page').style.display = 'block';
  document.getElementById('cart-page').style.display = 'none';
  
  // Обновляем навигацию
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
  });
  document.querySelectorAll('.nav-item')[0].classList.add('active');
  
  renderProducts(allProducts);
}

// Отобразить корзину
function renderCart() {
  const container = document.getElementById('cart-items-container');
  const summaryContainer = document.getElementById('cart-summary-container');
  
  if (cart.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-shopping-cart"></i>
        <h3>Корзина пуста</h3>
        <p>Добавьте товары из каталога</p>
      </div>
    `;
    summaryContainer.innerHTML = '';
    return;
  }
  
  container.innerHTML = '';
  
  cart.forEach((item, index) => {
    const cartItem = document.createElement('div');
    cartItem.className = 'cart-item';
    
    cartItem.innerHTML = `
      <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
        <div style="width: 50px; height: 50px; background: #1a1a24; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
          <img src="${item.image}" alt="${item.name}" style="width: 30px; height: 30px; object-fit: contain;">
        </div>
        <div class="cart-item-info">
          <div class="cart-item-name">${item.name}</div>
          ${item.flavor ? `<div class="cart-item-flavor">${item.flavor}</div>` : ''}
          <div class="cart-item-price">${item.price.toFixed(2)} zł</div>
        </div>
      </div>
      <button class="btn-remove" onclick="removeFromCart(${index})">
        <i class="fas fa-trash"></i>
      </button>
    `;
    
    container.appendChild(cartItem);
  });
  
  // Рассчитываем итоговую сумму
  const total = cart.reduce((sum, item) => sum + item.price, 0);
  
  summaryContainer.innerHTML = `
    <div class="cart-summary">
      <div class="cart-total">
        <span>Итого:</span>
        <span class="cart-total-amount">${total.toFixed(2)} zł</span>
      </div>
      <button class="telegram-payment" onclick="processTelegramPayment()">
        <i class="fab fa-telegram"></i>
        Оплатить через Telegram
      </button>
      <div class="payment-info">
        <p>Для оформления заказа напишите менеджеру в Telegram:</p>
        <div class="telegram-username">@managercloudm</div>
        <p>Сообщите менеджеру список товаров из корзины и общую сумму</p>
      </div>
    </div>
  `;
}

// Удалить товар из корзины
function removeFromCart(index) {
  if (index >= 0 && index < cart.length) {
    const item = cart[index];
    cart.splice(index, 1);
    saveCart();
    updateCartBadge();
    renderCart();
    showNotification(`Товар удален из корзины: ${item.name}`);
  }
}

// Обработка оплаты через Telegram
function processTelegramPayment() {
  if (cart.length === 0) {
    showNotification('Корзина пуста');
    return;
  }
  
  const total = cart.reduce((sum, item) => sum + item.price, 0);
  const itemsList = cart.map(item => 
    `- ${item.name}${item.flavor ? ` (${item.flavor})` : ''}: ${item.price.toFixed(2)} zł`
  ).join('\n');
  
  const message = `Заказ из CloudHub\n\nТовары:\n${itemsList}\n\nИтого: ${total.toFixed(2)} zł\n\nДля оформления заказа свяжитесь с менеджером: @managercloudm`;
  
  // Копируем в буфер обмена
  const textArea = document.createElement('textarea');
  textArea.value = message;
  document.body.appendChild(textArea);
  textArea.select();
  document.execCommand('copy');
  document.body.removeChild(textArea);
  
  showNotification('Заказ скопирован. Отправьте менеджеру @managercloudm в Telegram');
  
  // Открываем Telegram
  window.open('https://t.me/managercloudm', '_blank');
}

// ========== УТИЛИТЫ ==========

// Показать уведомление
function showNotification(message) {
  // Создаем элемент уведомления
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: white;
    padding: 15px 25px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    font-weight: 600;
    animation: fadeIn 0.3s;
    max-width: 90%;
    text-align: center;
  `;
  notification.textContent = message;
  
  document.body.appendChild(notification);
  
  // Через 3 секунды удаляем уведомление
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transition = 'opacity 0.5s';
    setTimeout(() => document.body.removeChild(notification), 500);
  }, 3000);
}

// Закрытие модального окна при клике на фон
document.getElementById('flavor-modal').addEventListener('click', function(e) {
  if (e.target.id === 'flavor-modal') {
    closeFlavorModal();
  }
});

// Закрытие модального окна по клавише Escape
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeFlavorModal();
  }
});
</script>

</body>
</html>
